# debthin

Lean Debian package indexes at [debthin.org](https://debthin.org).

A minimal Debian container image is around 90MB. The first thing you do is
`apt update` - and apt downloads another 90MB of index files describing 68,000
packages, the overwhelming majority of which will never be installed on a
headless server. They sit in `/var/lib/apt/lists`, consuming space and bandwidth
on every container, on every host, on every update cycle, indefinitely.

debthin serves curated `Packages.gz` indexes filtered to ~6,700 server-relevant
packages - admin, database, devel, networking, interpreters, libs, web, video
and related sections. Desktop, GUI, games, fonts and hardware-specific packages
are excluded. The result is an index around 90% smaller than upstream.
Everything else - the actual `.deb` files - redirects transparently to
`deb.debian.org`. Nothing is rehosted.

The list is rebuilt daily from Debian's own Packages files, ranked by
[popcon](https://popcon.debian.org) install counts with a minimum threshold of
2,500 reported installations. Obscure but legitimate packages can be added via
pull request.

## Architecture

```
apt client
  │
  ├── GET dists/trixie/InRelease                      → Cloudflare KV (signed)
  ├── GET dists/trixie/main/binary-amd64/Packages.gz → Cloudflare KV (~6700 pkgs)
  └── GET pool/main/a/apt/apt_2.x_amd64.deb          → 301 → deb.debian.org
```

## Suites & Architectures

| Alias        | Codename | Architectures                  |
|--------------|----------|--------------------------------|
| testing      | forky    | amd64 arm64 armhf i386 riscv64 |
| stable       | trixie   | amd64 arm64 armhf i386 riscv64 |
| oldstable    | bookworm | amd64 arm64 armhf i386         |
| oldoldstable | bullseye | amd64 arm64 armhf i386         |

Aliases are resolved in the worker - `sources.list` can use either form.

## Setup

### Install key

If `gpg` is available:

```bash
curl -fsSL http://debthin.org/debthin-keyring.gpg \
  | gpg --dearmor \
  | tee /etc/apt/trusted.gpg.d/debthin.gpg > /dev/null
```

Without `gpg` (binary key, works on bare containers):

```bash
curl -fsSL http://debthin.org/debthin-keyring-binary.gpg \
  -o /etc/apt/trusted.gpg.d/debthin.gpg
```

### /etc/apt/sources.list.d/debthin.sources

```
Types: deb
URIs: http://debthin.org
Suites: trixie
Components: main
Signed-By: /etc/apt/trusted.gpg.d/debthin.gpg

# Security goes direct - keep it independent
Types: deb
URIs: https://security.debian.org/debian-security
Suites: trixie-security
Components: main
Signed-By: /usr/share/keyrings/debian-archive-keyring.gpg
```

Or classic sources.list format:

```
deb [signed-by=/etc/apt/trusted.gpg.d/debthin.gpg] http://debthin.org trixie main
deb [signed-by=/usr/share/keyrings/debian-archive-keyring.gpg] https://security.debian.org/debian-security trixie-security main
```

### /etc/apt/apt.conf.d/99thin

```
// Strip translation files and use compressed indexes
Acquire::Languages "none";
Acquire::GzipIndexes "true";
Acquire::CompressionTypes::Order:: "gz";
```

## Curation

`curated/packages.txt` - ~6,000 primary server packages (popcon ≥ 2,500)  
`curated/deps.txt` - ~700 dependency packages  
`curated/all.txt` - combined, generated by pipeline, not committed

To add packages: edit `curated/packages.txt`, commit, push.

To rebuild from popcon:
```bash
python3 scripts/curate.py --suite trixie --arch amd64
```

Or trigger via GitHub Actions with `force_recurate: true`.

## Pipeline

Runs daily at 04:00 UTC. Re-curates from popcon on Sundays.

GitHub secrets required:

| Secret | Value |
|--------|-------|
| `GPG_PRIVATE_KEY` | `gpg --armor --export-secret-keys mirror@debthin.org` |
| `GPG_KEY_ID` | key fingerprint |
| `CF_ACCOUNT_ID` | Cloudflare account ID |
| `CF_API_TOKEN` | CF API token with KV write permission |
| `CF_KV_NAMESPACE_ID` | from `wrangler kv:namespace create MIRROR_KV` |

## Trademark notice

Debian is a registered trademark of
[Software in the Public Interest, Inc](https://www.spi-inc.org/).
debthin is an independent project and is not affiliated with, endorsed by,
or sponsored by the Debian Project. Use of the name "deb" in "debthin" refers
to the `.deb` package format and Debian ecosystem, consistent with
[Debian's trademark policy](https://www.debian.org/trademark) for software
that works with Debian systems. debthin does not redistribute Debian packages -
all package files are served directly from official Debian mirrors.
